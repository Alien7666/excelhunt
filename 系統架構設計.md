# ExcelHunt 系統架構設計文件

## 1. 系統概述

ExcelHunt 是一個基於 Spring Boot 開發的網頁應用程式，主要目的是提供高效的 Excel 資料搜尋功能。本系統採用現代化的多層架構設計，包含前端展示層、應用服務層、資料存取層等。

## 2. 系統架構

### 2.1 整體架構

ExcelHunt 採用經典的 MVC 架構模式，主要分為以下幾層：

- **表示層 (Presentation Layer)**: 透過 Thymeleaf 模板引擎渲染的網頁介面
- **控制層 (Controller Layer)**: 負責處理 HTTP 請求和回應，控制頁面流程
- **服務層 (Service Layer)**: 實現核心業務邏輯，如搜尋演算法
- **資料存取層 (Data Access Layer)**: 與 MongoDB 互動的儲存庫類別
- **安全層 (Security Layer)**: 基於 Spring Security 的身份驗證和授權機制

```
+------------------+
|    使用者介面     |
|   (Thymeleaf)    |
+--------+---------+
         |
+--------+---------+
|   控制器層        |
| (Controllers)    |
+--------+---------+
         |
+--------+---------+
|    服務層         |
|   (Services)     |
+--------+---------+
         |
+--------+---------+
|  資料存取層       |
| (Repositories)   |
+--------+---------+
         |
+--------+---------+
|    資料庫         |
|   (MongoDB)      |
+------------------+
```

### 2.2 技術堆疊

- **後端框架**: Spring Boot 2.7.15
- **資料庫**: MongoDB
- **前端技術**: Thymeleaf, HTML, CSS, JavaScript
- **安全框架**: Spring Security
- **建構工具**: Maven
- **雲端整合**: Google Cloud Storage
- **開發輔助**: Lombok
- **容器化**: Docker

## 3. 核心組件

### 3.1 搜尋引擎 (SearchService)

搜尋引擎是系統的核心組件，主要分為兩個實現：

- `SearchService`: 基本搜尋服務，提供單執行緒搜尋功能
- `SearchServicemuticore`: 多核心搜尋服務，使用並行處理提升搜尋效能

主要特點：
- 支援多集合同時搜尋
- 使用正則表達式進行模糊匹配
- 即時整合搜尋結果
- 記錄搜尋歷史
- 效能監控和時間統計

### 3.2 安全架構 (SecurityConfig)

系統安全建構在 Spring Security 框架之上，主要組件包括：

- `SecurityConfig`: 安全配置類，定義訪問控制規則和身份驗證策略
- `CustomUserDetailsService`: 自定義使用者詳情服務，從 MongoDB 讀取使用者資訊
- `CustomAuthenticationSuccessHandler`: 身份驗證成功處理器
- `CustomAuthenticationFailureHandler`: 身份驗證失敗處理器

### 3.3 控制器層

系統包含多個控制器，各自負責不同的功能區塊：

- `SearchController`: 處理搜尋相關請求
- `LoginController`: 處理登入和註冊
- `PasswordController`: 管理密碼變更
- `SettingController`: 使用者設定管理
- `MenuController`: 導航選單管理
- `ControlController`: 管理控制頁面
- `ChangelogsController`: 變更記錄管理

### 3.4 資料模型

主要資料模型包括：

- `User`: 使用者資訊，包含帳號、密碼和角色
- `Link`: 系統內的連結資訊

## 4. 資料庫設計

系統使用 MongoDB 作為主要資料庫，包含以下主要集合：

- `user`: 儲存使用者資訊，包含帳號、加密密碼和角色
- `儲位資料`: 儲存庫存位置相關資訊
- `月庫存`: 月度庫存記錄
- `毛量`: 毛重相關資料
- `產品資料`: 產品基本資訊
- `SearchRecords`: 搜尋歷史記錄

## 5. 安全設計

系統的安全機制主要基於以下幾個方面：

- **身份驗證**: 基於表單的身份驗證機制
- **密碼加密**: 使用 BCrypt 加密演算法
- **訪問控制**: 基於角色的授權控制
- **安全會話管理**: 處理使用者會話

## 6. 部署架構

系統支援多種部署方式：

### 6.1 標準部署
使用 JAR 檔案在 Java 環境中直接執行，需要外部 MongoDB 服務。

### 6.2 Docker 部署
使用 Docker 容器化技術部署，可以同時容器化應用和資料庫。

```
+------------------+    +------------------+
|   ExcelHunt App  |    |     MongoDB      |
|    (Container)   |<-->|    (Container)   |
+------------------+    +------------------+
         |
+------------------+
|   Docker Network |
+------------------+
```

## 7. 效能優化

系統採用了以下幾種效能優化策略：

1. **多執行緒搜尋**: 利用並行處理提高搜尋效能
2. **使用者經驗優化**: 搜尋結果即時顯示，避免頁面刷新
3. **資料庫索引優化**: 對常用搜尋欄位建立索引
4. **查詢效能監控**: 記錄搜尋時間，分析效能瓶頸

## 8. 擴展性設計

系統的擴展性主要體現在以下幾個方面：

1. **模組化設計**: 各功能模組之間低耦合，便於添加新功能
2. **可配置性**: 主要參數通過配置文件控制
3. **資料庫擴展**: MongoDB 的水平擴展能力
4. **容器化部署**: 便於雲端環境擴展

## 9. 未來優化方向

1. **搜尋演算法優化**: 引入全文檢索、相關性排序等進階功能
2. **資料可視化**: 添加圖表和儀表板功能
3. **API擴展**: 開發 RESTful API 以支援第三方整合
4. **多語言支援**: 添加國際化支援
5. **即時通知**: 整合 WebSocket 支援即時通知

## 10. 總結

ExcelHunt 系統架構基於現代化的 Spring Boot 技術，實現了高效的 Excel 資料搜尋功能。系統採用多層架構設計，具有良好的模組化和可擴展性。通過優化的多執行緒搜尋引擎和安全機制，為使用者提供高效、安全的資料搜尋體驗。
